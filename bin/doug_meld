#!/bin/bash

cd ~/qvtrace/testing/models
source support_scripts/utils.sh
IFS=$'\n'
for i in `grep 31m /tmp/doug_tests.log`
do
    if [[ "${i}" == *"Change in "* ]] ; then
        o=`echo "${i}" | sed 's/.*Change in \(.*\....\).*/\1/'`
        n="tmp/${o}"
    elif [[ "{$i}" == *"Output changed"* ]] ; then
        type=`echo "${i}" | sed 's/.*Analyzing.*using \(.*\):.*/\1/' | tr '[:upper:]' '[:lower:]'`
        path=`echo "${i}" | sed 's#.*/testing/models/\(.*\)\.qvt.*#\1#'`
        o="${path}.${type}.cli.out"
        n="tmp/${o}"
    fi
    if [ ! $o ] ; then echo "SKIPPING" ; continue; fi
        meld $o $n
    if [ $? == 1 ] ; then exit 1; fi  # Control-C probably
done
unset IFS
